<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Wishlist</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6e9de4;
            --accent-color: #ff6b6b;
            --background-color: #ffffff;
            --card-background: #f8f9fa;
            --text-color: #333333;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --input-background: #ffffff;
        }

        .dark-mode {
            --primary-color: #6e9de4;
            --secondary-color: #4a6fa5;
            --accent-color: #ff8e8e;
            --background-color: #1a1a2e;
            --card-background: #16213e;
            --text-color: #e6e6e6;
            --border-color: #2d4059;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --input-background: #2d4059;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: var(--card-background);
            border-radius: 10px;
            box-shadow: 0 4px 15px var(--shadow-color);
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.5rem;
            color: var(--accent-color);
        }

        .logo h1 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-filter-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        #searchBar, #filterSelect {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            background-color: var(--input-background);
            color: var(--text-color);
        }

        #searchBar {
            width: 200px;
        }

        .theme-toggle {
            background: var(--card-background);
            border: 2px solid var(--border-color);
            width: 60px;
            height: 30px;
            border-radius: 15px;
            position: relative;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 0 5px;
        }

        .toggle-circle {
            position: absolute;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background-color: var(--primary-color);
            transition: transform 0.3s;
        }

        .dark-mode .toggle-circle {
            transform: translateX(30px);
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .login-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        .add-btn {
            background: linear-gradient(45deg, #4ecdc4, #1a936f);
            color: white;
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        .logout-btn {
            background: var(--card-background);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            display: none;
        }

        .logout-btn:hover {
            background: var(--border-color);
        }

        .wishlist-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .wishlist-item {
            background: var(--card-background);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px var(--shadow-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
        }

        .wishlist-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px var(--shadow-color);
        }

        .item-image {
            height: 200px;
            overflow: hidden;
            position: relative;
        }

        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .wishlist-item:hover .item-image img {
            transform: scale(1.05);
        }

        .item-details {
            padding: 20px;
        }

        .item-date {
            font-size: 0.85rem;
            color: var(--secondary-color);
            margin-bottom: 10px;
        }

        .item-description {
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .item-price {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .item-link {
            display: block;
            text-align: center;
            padding: 10px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 600;
            transition: background 0.3s ease;
            margin-top: 15px;
        }

        .item-link:hover {
            opacity: 0.9;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 10;
        }

        .wishlist-item:hover .delete-btn {
            opacity: 1;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--card-background);
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }

        .close-btn {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }

        h2 {
            margin: 20px 0;
            color: var(--primary-color);
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
            background-color: var(--input-background);
            color: var(--text-color);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #4ecdc4, #1a936f);
            color: white;
            font-size: 1.1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .submit-btn:hover {
            opacity: 0.9;
        }

        .image-preview {
            width: 100%;
            height: 200px;
            border: 2px dashed var(--border-color);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .status-message {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            display: none;
        }

        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .category-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            margin-top: 8px;
        }
        .cat-clothes { background-color: #6f42c1; }
        .cat-shoes { background-color: #e83e8c; }
        .cat-computer { background-color: #17a2b8; }
        .cat-dma { background-color: #fd7e14; }
        .cat-decor { background-color: #20c997; }
        .cat-furniture { background-color: #007bff; }
        .cat-rabbit { background-color: #28a745; }
        .cat-personal { background-color: #ffc107; color: #000; }
        .cat-misc { background-color: #6c757d; }

        @media (max-width: 768px) {
            .wishlist-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            header {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-controls {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }

            .search-filter-container {
                width: 100%;
                justify-content: center;
            }

            #searchBar {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-gift"></i>
                <h1>My Wishlist</h1>
            </div>
            <div class="header-controls">
                <div class="search-filter-container">
                    <!-- New Sizes Button -->
                    <button class="add-btn" id="sizesBtn"><i class="fas fa-ruler"></i> Sizes</button>
                    
                    <input type="text" id="searchBar" placeholder="Search items...">
                    <select id="filterSelect">
                        <option value="all">All Categories</option>
                        <option value="clothes">Clothes</option>
                        <option value="shoes">Shoes</option>
                        <option value="computer">Computer</option>
                        <option value="dma">DMA</option>
                        <option value="decor">Decor</option>
                        <option value="furniture">Furniture</option>
                        <option value="rabbit">Rabbit</option>
                        <option value="personal">Personal</option>
                        <option value="misc">Misc</option>
                    </select>
                </div>
                <div class="theme-toggle" id="themeToggle">
                    <div class="toggle-circle"></div>
                </div>
                <button class="login-btn" id="loginBtn"><i class="fas fa-lock"></i> Login</button>
                <button class="add-btn" id="addBtn"><i class="fas fa-plus"></i> Add Item</button>
                <button class="logout-btn" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </header>

        <div id="statusMessage" class="status-message"></div>

        <div class="wishlist-grid" id="wishlistGrid">
            <!-- Wishlist items will be dynamically added here -->
        </div>

        <!-- Login Modal -->
        <div class="modal" id="loginModal">
            <div class="modal-content">
                <span class="close-btn" id="closeLogin">&times;</span>
                <h2>Admin Login</h2>
                <div class="form-group">
                    <label for="pin">Enter PIN:</label>
                    <input type="password" id="pin" placeholder="Enter secret PIN">
                </div>
                <button class="submit-btn" id="submitLogin">Login</button>
            </div>
        </div>

        <!-- Add Item Modal -->
        <div class="modal" id="addItemModal">
            <div class="modal-content">
                <span class="close-btn" id="closeAddItem">&times;</span>
                <h2>Add New Wishlist Item</h2>
                
                <div class="form-group">
                    <label for="imageSource">Image Source:</label>
                    <select id="imageSource">
                        <option value="url">Image URL</option>
                        <option value="upload">Upload Image</option>
                    </select>
                </div>
                
                <div class="form-group" id="imageUrlGroup">
                    <label for="imageUrl">Image URL:</label>
                    <input type="text" id="imageUrl" placeholder="Paste image URL here">
                </div>
                
                <div class="form-group" id="imageUploadGroup" style="display: none;">
                    <label for="imageUpload">Upload Image:</label>
                    <input type="file" id="imageUpload" accept="image/*">
                    <div class="image-preview" id="imagePreview">
                        <span>Preview will appear here</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="itemLink">Item Link:</label>
                    <input type="text" id="itemLink" placeholder="Paste link to the item">
                </div>
                <div class="form-group">
                    <label for="itemDescription">Description:</label>
                    <textarea id="itemDescription" placeholder="Describe the item"></textarea>
                </div>
                <div class="form-group">
                    <label for="itemPrice">Price:</label>
                    <input type="number" id="itemPrice" placeholder="Enter price (e.g. 49.99)" step="0.01">
                </div>
                <div class="form-group">
                    <label for="itemCategory">Category:</label>
                    <select id="itemCategory">
                        <option value="clothes">Clothes</option>
                        <option value="shoes">Shoes</option>
                        <option value="computer">Computer</option>
                        <option value="dma">DMA</option>
                        <option value="decor">Decor</option>
                        <option value="furniture">Furniture</option>
                        <option value="rabbit">Rabbit</option>
                        <option value="personal">Personal</option>
                        <option value="misc">Misc</option>
                    </select>
                </div>
                <button class="submit-btn" id="submitItem">Add to Wishlist</button>
            </div>
        </div>

        <!-- Sizes Modal -->
        <div class="modal" id="sizesModal">
            <div class="modal-content">
                <span class="close-btn" id="closeSizes">&times;</span>
                <h2>Sizes</h2>
                <ul style="list-style:none; padding-left:0; font-size:1.1rem; line-height:1.6;">
                    <li><strong>Shoe:</strong> 11</li>
                    <li><strong>Shirts:</strong> Men XL</li>
                    <li><strong>Shirts Tall:</strong> Men M</li>
                    <li><strong>Hoodie:</strong> Men XL</li>
                    <li><strong>Waist/Leg Length:</strong> 32/30</li>
                    <li><strong>Sweats:</strong> Men L</li>
                    <li><strong>Socks:</strong> Men L</li>
                </ul>
            </div>
        </div>

        <footer>
            <p>Birthday & Christmas Wishlist | Data stored on GitHub</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
			const themeToggle = document.getElementById('themeToggle');
			const loginBtn = document.getElementById('loginBtn');
			const addBtn = document.getElementById('addBtn');
			const logoutBtn = document.getElementById('logoutBtn');
			const wishlistGrid = document.getElementById('wishlistGrid');
			const loginModal = document.getElementById('loginModal');
			const addItemModal = document.getElementById('addItemModal');
			const closeLogin = document.getElementById('closeLogin');
			const closeAddItem = document.getElementById('closeAddItem');
			const submitLogin = document.getElementById('submitLogin');
			const submitItem = document.getElementById('submitItem');
			const imageSource = document.getElementById('imageSource');
			const imageUrlGroup = document.getElementById('imageUrlGroup');
			const imageUploadGroup = document.getElementById('imageUploadGroup');
			const imageUpload = document.getElementById('imageUpload');
			const imagePreview = document.getElementById('imagePreview');
			const statusMessage = document.getElementById('statusMessage');
			
			const searchBar = document.getElementById('searchBar');
			const filterSelect = document.getElementById('filterSelect');
			const itemPriceInput = document.getElementById('itemPrice');
			const itemCategoryInput = document.getElementById('itemCategory');

			const sizesBtn = document.getElementById('sizesBtn');
			const sizesModal = document.getElementById('sizesModal');
			const closeSizes = document.getElementById('closeSizes');
			
			if (localStorage.getItem('darkMode') === 'enabled') {
				document.body.classList.add('dark-mode');
			}

			let wishlistItems = [];
			let isLoggedIn = sessionStorage.getItem('isLoggedIn') === 'true';
			updateUI();

			// ðŸ”’ Dropbox token + path (base64)
			const Q1 = [
				"c2wudS5BRjdQX2E2bHFxT0ZoSy1OWlZUSEpqdmJiZFlYejRoVzIzbF90UnlyUlhWRkw1OW15dEdGcW9USGhOZHhlNHRBNTlIcDE0X2l0RS1JdnpWOXJYaTlmcGZRUzhTWV9xRVdtalJpZE1sVlIzOXdPVVpqWXVVV0MtWk9kUjdzZEVMcTNLVVhCZXo0WTlja2FJcDcxZGt5MXBRT0tzeFlhNmFtVmRLQ1ppc0E0QU8zbWdxcjctUlVlZW9KZGtaaFc2cjhyUzNzZ2VYOGkwOFJqaWxfb3BuZS1hYXRBZzM4cGlZakp5bDdXYy1lV3FuVS1BYWRhTkhxWTRuUTY2eThVVmFIQlhXcldEUUptX0tXbk5aM3VXeVdVVTJrWHFDV21lN1NzR01EMVNTWUJzM2FORFczZGxtQzF5YVgyS2c5Yl94VHhfS3NwZ0pkNkYxa2VMX000ZWRyV2ZFa3ZfTlNFYldwcEFJUjU5SnJtRGhLUXoyUTduVnlkLTBUVXJmQ2hfMXc4Z3ZUbUlkZkZqRU1vRjV2dFAtZm9TUmQ2cDkwZWtWeTJPRHZrd0Jlbm94cF8zbElkbDhzVEF0bC1UdS1NNDFBOXRzN2dzY0Nab3dqV0xRWlJJWnliVWszNXVNNzBYSUVLb0d6MEc5clVnaFhlY0VIV0oybWdPcjVPXzd3VjVMeW5yM0s0Q2lhSnpsb0tIX3dDTGpzTlNjYXhuNUVrR2VwM1FHUThRQ2s1Wk5Xdmt2VWE3Vlk1TFhDbVhaZjFSQTd3b3pvT09XSWl6dnlZX1F0RUhDOFRGMjN3bHY0ekRGem1IclN3SnlDVVByb0M4S29TOXYyUWdSSkxjc19NMlI2dW5OdzFyUWNmS3pzRkxSZGpSYXN0NmJDdUZoZGx1blFFaVg4eEVHQUJjdllSSHQ4VmRvbjJvaG5qNkhwT2E4TFdwQkpDWG9iRjY1VlV4NXdHQXZNd0MyVGpuaEdrenFkTHdTWFYtanlhd1BIdlQ3WkUyUlg4RGhja096cnhWUDFLVDhKSGNuTGlCSjQxZkFyODdhV2ExVWQ4MW5GdnhMVl9JRGhRMmQ4emJVNGNBTWZYSUpTT1EtVi1PTEFMTHhBNUlNVDMxeTVmY1ViQWQ4SDNfRTFoZDVKYWo0Rk1ReDFFb3NFZjRMSXp3a2t3T1p3cEVDLXpTNzRUU21pNklGVzFZdXNYWTRpZVhQUzI2ZmE0SE93QXU2N09WQUl6V1ZDRjJ6MV90TnNsZGxCWVhsYW1MelhUZFpjSmZSSS13c1NjeEhtaG5zYkdpRS1DT0syVUJnNWIzTHR4TG5iamFRMkl3bTZnbENCbFYzdFNCNnhraVNDeU1vNFQ3QjhxTmcxdXlHamZndEV5NXhWVWp1dFZuT0M4NjNDWVFOWGQ4OVdGY052dWUwdTR1cUdrd2JMcDkwZDhOdW8tYW8tQmFYMEQ2Sk5Hbm9ySW8zeDZsRG9wRlIta3d5MTZrTUh3UTh1YjVvYTlrU1RIN3hIb3hrdS1WR3NUNGMxYVNKNGNieUQ1bURBX2hCUUs1R1laeE1Obkoxb016bnktQ1R2M1ZldXFpdlk2NG1EcmlwSW5zVEJZNzdVR1o4bGxxc1djdjBfU25WaVpiZXN4VWVjcDRrZUp0Z0U5NHdQaHhaZmxHUG5TWGt4LUJUUjE0RXdSbG1zTTNrcGdKZlh2bE9lRkpZdzgzR05nSDRoQjB2Y2VUMHlmOVFCWGdSSQ==",
				"L3dpc2hsaXN0Lmpzb24=" // "/wishlist.json"
			];
			function ZxQp(v){ return atob(v); }
			function getToken(){ return ZxQp(Q1[0]); }
			function getPath(){ return ZxQp(Q1[1]); }

			async function loadFromDropbox() {
				try {
					const res = await fetch("https://content.dropboxapi.com/2/files/download", {
						method: "POST",
						headers: {
							"Authorization": "Bearer " + getToken(),
							"Dropbox-API-Arg": JSON.stringify({ path: getPath() })
						}
					});
					if (!res.ok) throw new Error("Dropbox error " + res.status);
					const text = await res.text();
					wishlistItems = text.trim() ? JSON.parse(text) : [];
					renderWishlist();
					showStatus("Wishlist loaded from Dropbox!", "success");
				} catch (e) {
					wishlistItems = [];
					renderWishlist();
					showStatus("Error loading: " + e.message, "error");
				}
			}

			async function saveToDropbox() {
				try {
					await fetch("https://content.dropboxapi.com/2/files/upload", {
						method: "POST",
						headers: {
							"Authorization": "Bearer " + getToken(),
							"Dropbox-API-Arg": JSON.stringify({ path: getPath(), mode: "overwrite", mute: true }),
							"Content-Type": "application/octet-stream"
						},
						body: JSON.stringify(wishlistItems)
					});
					showStatus("Saved to Dropbox!", "success");
				} catch (e) {
					showStatus("Save error: " + e.message, "error");
				}
			}

			// Replace delete function to always save to Dropbox
			window.deleteItem = function(id) {
				if (confirm("Are you sure you want to delete this item?")) {
					wishlistItems = wishlistItems.filter(item => item.id !== id);
					renderWishlist();
					saveToDropbox();
					showStatus("Item deleted successfully!", "success");
				}
			};

			// Initial load
			loadFromDropbox();
            
            // Event Listeners
            themeToggle.addEventListener('click', toggleDarkMode);
            loginBtn.addEventListener('click', () => loginModal.style.display = 'flex');
            addBtn.addEventListener('click', () => addItemModal.style.display = 'flex');
            logoutBtn.addEventListener('click', logout);

            // Sizes button events
            sizesBtn.addEventListener('click', () => sizesModal.style.display = 'flex');
            closeSizes.addEventListener('click', () => sizesModal.style.display = 'none');
            
            closeLogin.addEventListener('click', () => loginModal.style.display = 'none');
            closeAddItem.addEventListener('click', () => addItemModal.style.display = 'none');
            
            imageSource.addEventListener('change', function() {
                if (this.value === 'url') {
                    imageUrlGroup.style.display = 'block';
                    imageUploadGroup.style.display = 'none';
                } else {
                    imageUrlGroup.style.display = 'none';
                    imageUploadGroup.style.display = 'block';
                }
            });
            
            imageUpload.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imagePreview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // New event listeners for search and filter
            searchBar.addEventListener('input', renderWishlist);
            filterSelect.addEventListener('change', renderWishlist);
            
            submitLogin.addEventListener('click', function() {
                const pin = document.getElementById('pin').value;
                if (pin === '1423') { // Simple PIN check
                    isLoggedIn = true;
                    sessionStorage.setItem('isLoggedIn', 'true');
                    updateUI();
                    loginModal.style.display = 'none';
                    showStatus('Login successful!', 'success');
                } else {
                    showStatus('Incorrect PIN. Please try again.', 'error');
                }
            });
            
            submitItem.addEventListener('click', function() {
                const imageUrl = document.getElementById('imageUrl').value;
                const itemLink = document.getElementById('itemLink').value;
                const description = document.getElementById('itemDescription').value;
                const price = itemPriceInput.value;
                const category = itemCategoryInput.value;
                
                if ((imageUrl || imageUpload.files.length > 0) && itemLink && description) {
                    let imageSrc = imageUrl;
                    
                    if (imageSource.value === 'upload' && imageUpload.files.length > 0) {
                        const file = imageUpload.files[0];
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            imageSrc = e.target.result;
                            addItemToWishlist(imageSrc, itemLink, description, price, category);
                        };
                        reader.readAsDataURL(file);
                    } else {
                        addItemToWishlist(imageSrc, itemLink, description, price, category);
                    }
                } else {
                    showStatus('Please fill in all fields.', 'error');
                }
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === loginModal) {
                    loginModal.style.display = 'none';
                }
                if (event.target === addItemModal) {
                    addItemModal.style.display = 'none';
                }
                if (event.target === sizesModal) {
                    sizesModal.style.display = 'none';
                }
            });
            
            // Functions
            function toggleDarkMode() {
                document.body.classList.toggle('dark-mode');
                if (document.body.classList.contains('dark-mode')) {
                    localStorage.setItem('darkMode', 'enabled');
                } else {
                    localStorage.setItem('darkMode', 'disabled');
                }
            }
            
            function updateUI() {
                if (isLoggedIn) {
                    loginBtn.style.display = 'none';
                    addBtn.style.display = 'block';
                    logoutBtn.style.display = 'block';
                } else {
                    loginBtn.style.display = 'block';
                    addBtn.style.display = 'none';
                    logoutBtn.style.display = 'none';
                }
                renderWishlist();
            }
            
            function logout() {
                isLoggedIn = false;
                sessionStorage.setItem('isLoggedIn', 'false');
                updateUI();
                showStatus('You have been logged out.', 'success');
            }
            
            function addItemToWishlist(imageSrc, itemLink, description, price, category) {
                const newItem = {
                    id: Date.now(),
                    image: imageSrc,
                    date: new Date().toISOString().split('T')[0],
                    description: description,
                    link: itemLink,
                    price: price,
                    category: category
                };
                
                wishlistItems.push(newItem);
                renderWishlist();
                
                document.getElementById('imageUrl').value = '';
                document.getElementById('itemLink').value = '';
                document.getElementById('itemDescription').value = '';
                itemPriceInput.value = '';
                itemCategoryInput.value = 'clothes';
                imagePreview.innerHTML = '<span>Preview will appear here</span>';
                imageUpload.value = '';
                addItemModal.style.display = 'none';
                
                saveToDropbox();
            }
            
            function deleteItem(id) {
                if (confirm("Are you sure you want to delete this item?")) {
                    wishlistItems = wishlistItems.filter(item => item.id !== id);
                    renderWishlist();
                    saveToDropbox();
                    showStatus('Item deleted successfully!', 'success');
                }
            }
            
            function renderWishlist() {
                wishlistGrid.innerHTML = '';
                
                let filteredItems = wishlistItems;

                const searchQuery = searchBar.value.toLowerCase();
                if (searchQuery) {
                    filteredItems = filteredItems.filter(item =>
                        item.description.toLowerCase().includes(searchQuery)
                    );
                }

                const selectedCategory = filterSelect.value;
                if (selectedCategory !== 'all') {
                    filteredItems = filteredItems.filter(item => item.category === selectedCategory);
                }
                
                if (filteredItems.length === 0) {
                    wishlistGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; padding: 40px;">No matching items found.</p>';
                    return;
                }
                
                filteredItems.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.classList.add('wishlist-item');
                    
                    itemElement.innerHTML = `
                        ${isLoggedIn ? `<button class="delete-btn" onclick="deleteItem(${item.id})"><i class="fas fa-times"></i></button>` : ''}
                        <div class="item-image">
                            <img src="${item.image}" alt="Wishlist item" onerror="this.src='https://images.unsplash.com/photo-1546868871-7041f2a55e12?auto=format&fit=crop&w=600&q=80'">
                        </div>
                        <div class="item-details">
                            <div class="item-date">Added: ${item.date}</div>
                            <p class="item-description">${item.description}</p>
                            <p class="item-price"><strong>Price:</strong> $${item.price || 'N/A'}</p>
                            <span class="category-badge cat-${item.category}">
                                ${item.category.charAt(0).toUpperCase() + item.category.slice(1)}
                            </span>
                            <a href="${item.link}" target="_blank" class="item-link">View Item</a>
                        </div>
                    `;
                    
                    wishlistGrid.appendChild(itemElement);
                });
            }
            
            function showStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.className = 'status-message';
                statusMessage.classList.add(`status-${type}`);
                statusMessage.style.display = 'block';
                
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 3000);
            }
        });
    </script>
</body>
</html>
